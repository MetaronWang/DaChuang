# 对地侦察项目报告

## 一. 飞机制作

对地参赛机采用改装现有成品机的方式，原型为天行者X6飞翼，先改装方案为在重心处加装投弹机构，前部加装摄像头，现尝试将其动力方式由后推单桨改装为双发前置，通过更为高速的桨气流，使其可以在更低的空速下飞行，代价是增大了阻力，但由于对地比赛时间不超过4分钟，阻力问题可以不必考虑。现在飞机有一架，另外两架已经提交采购，改装方案的电机座正在使用3D打印制作中。

## 二.当前进展

### 1.自动化方案

自动化方案使用dronekit控制库对刷写了APM固件的pixhawk飞控进行外部控制，**主要有两部分，路径规划与图像识别。两者均已经完成**，路径规划通过输入三个靶标的测量位置（靶标比赛前会预先放好，可以前去测量其精确位置）， 计算出一条飞行路径，随后上传航线文件进入飞控。避免飞机在自动飞行中做出剧烈的转弯影响航线精度，航线以直线与半径较大的圆弧组成。图像识别系统采用计算机视觉算法在图片中搜索目标，随后进行图像分割，使用训练好的卷积神经网络（CNN）模型进行识别，现在已经开发完毕，不过仍然需要根据靶标的航拍视频进行参数上的调整，这个时间是充足的。同时模型具备同时识别多个靶标的能力，在特殊情况下可以直接飞高一次性识别全部靶标。识别结果的使用jetson tx2开发板上面的高增益天线进行传回。

### 2.手动方案

手动方案即为传统方案，加装图传，摄像头，由操作手操作进行比赛，现在已经有了飞机，再组织一些训练就好。

## 三.测试情况

### 1.自动化地面测试

自动化地面测试，在8月17日，18日，28日进行。运行相关测试代码，成功使飞控解锁，电机开始运转。8月28日测试，成功将模型移植到协同计算机上，且通过运行。随后根据识别结果使电机运行。并遇到了一些问题，如下

1. 模型加载时间过长，达到了11秒。                                                                      

2. 开机时内存分配出错，无法运行。

解决方法：

1. 模型预先加载进内存，识别时调用
2. 修改CUDA的相关参数，解决

### 2.手动飞行测试

手动飞行测试已经进行了两次，在9月6日与9月9日进行，9月6日测试飞行为纯手动飞行，发现其速度过快，9月9日测试时加装了飞控。其飞行质量大大提升。速度也有效降低。不过为了使自动方案的图像识别更好的运行，仍然寻求改装使其速度降低。

### 3.自动飞行测试

9月9日进行了自动飞行测试，测试其飞行直线航线与圆弧航线的准确性，结果较为准确，需要注意的是要合理的设置航点半径，航点高度等参数。且经测试，外部计算机可成功将规划好的路径上传至飞控。但由于飞机撞上信号塔需要维修，故这里位经实际飞行测试。

## 四.后续所需工作

1. 飞机的改装，由单发改为双发
2. 图像识别模型的调整
3. 自动组进行全系统测试，调节摄像头安装角度，快门速度，等参数
4. 手动组的训练
5. 制定相关备份方案

## 五.对于备份方案的一些思考

根据评分规则，可以在投弹的准确率不高时，在侦察完之后，放弃投弹，迅速返航，争取任务分。上述方案可以通过一个较高的高度一次性识别三个靶标来实现。

## 六.相关参考链接

- [ ] https://github.com/wwzzyyzzrr/DaChuang
- [ ] http://python.dronekit.io/guide/auto_mode.html
- [ ] http://python.dronekit.io/examples/index.html